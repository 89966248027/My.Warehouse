@using AntDesign.TableModels
@using My.Warehouse.Client.Client.Models.Shipment

<div>
    <Table TItem="ShipmentDocumentData" DataSource="@Data" OnRowClick="@OnOpen" HidePagination OnExpand="OnRowExpand">
        <ColumnDefinitions>
            <PropertyColumn Property="c => c.Number"/>
            <PropertyColumn Property="c => c.DocumentDate"/>
            <PropertyColumn Property="c => c.ClientName"/>
        </ColumnDefinitions>
        <ExpandTemplate Context="rowData">
            <Table TItem="ShipmentResourceData" DataSource="@rowData.Data.Resources" HidePagination>
                <PropertyColumn Property="c => c.ResourceName"/>
                <PropertyColumn Property="c => c.MeasurementUnitName"/>
                <PropertyColumn Property="c => c.Amount"/>
            </Table>
        </ExpandTemplate>
    </Table>
</div>

@code {

    [Parameter]
    public required IEnumerable<ShipmentDocumentData> Data { get; set; }

    [Parameter]
    public EventCallback<Guid?> Open { get; set; } = new EventCallback<Guid?>();

    private async Task OnOpen(RowData<ShipmentDocumentData> row)
    {
        await Open.InvokeAsync(row.Data.Id);
    }
    
    void OnRowExpand(RowData<ShipmentDocumentData> rowData)
    {
        if (!rowData.Data.Resources.Any())
        {
            return;
        }

        StateHasChanged();
    }

}